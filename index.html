<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/gh/ismyrnow/leaflet-groupedlayercontrol@gh-pages/dist/leaflet.groupedlayercontrol.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ismyrnow/leaflet-groupedlayercontrol@gh-pages/dist/leaflet.groupedlayercontrol.min.css"/>
    <style>
      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      #map {
        width: 100%;
        height: 100%;
      }
    </style>
    <style>
    .legend {
  padding: 4px 6px;
  font: 12px Arial, Helvetica, sans-serif;
  background: white;
  background: rgba(255, 255, 255, 0.8);
  line-height: 22px;
  color: #555;
}
.legend h4 {
  text-align: center;
  font-size: 14px;
  margin: 2px 12px 8px;
  color: #777;
}

.legend span {
  position: relative;
  bottom: 3px;
}

.legend i {
  width: 18px;
  height: 18px;
  float: left;
  margin: 0 8px 0 0;
  opacity: 0.7;
}

.legend i.icon {
  background-size: 18px;
  background-color: rgba(255, 255, 255, 1);
}
  </style>
  </head>
  <body>
    <div id="map"></div>
    <script type="text/javascript">
	       //OSM+Carto tiles attribution and URL
	    	var osmLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
		var osmAttrib = '&copy; ' + osmLink;
	   
	        var placeholderLink = '<a href="http://openstreetmap.org">Placeholder link to publication</a>'
		
		var cartoLink = '<a href="http://cartodb.com/attributions">CartoDB</a>';
		var cartoURL = 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
		var cartoAttrib = '&copy; ' + osmLink + ' &copy; ' + cartoLink + ' &nbsp; ' + placeholderLink;
	    		
		//USGS tiles attribution and URL
		var USGSURL = 'https://basemap.nationalmap.gov/arcgis/rest/services/USGSImageryOnly/MapServer/tile/{z}/{y}/{x}';
		var USGSAttrib = 'Tiles courtesy of the <a href="https://usgs.gov/">U.S. Geological Survey</a>' + placeholderLink;

		//Creation of map tiles
		var cartoMap = L.tileLayer(cartoURL, {attribution: cartoAttrib});
		var USGSMap = L.tileLayer(USGSURL, {attribution: USGSAttrib,
	       	        subdomains: 'abcd',
			minZoom: 0,
			maxZoom: 20,
			ext: 'png'});
	    
	        //geojson files
	         var pc16Url = 'https://spatialepidemiology.github.io/SACData/assets/pc_tr16_tr.json';
	         var pc19Url = 'https://spatialepidemiology.github.io/SACData/assets/pc_tr19_tr.json';
	    	 var sc16Url = 'https://spatialepidemiology.github.io/SACData/assets/sc_tr16_tr.json';
	    	 var sc19Url = 'https://spatialepidemiology.github.io/SACData/assets/sc_tr19_tr.json';   
	         // choropleth style
	         function getColor1(d) {
                    return d > 300 ? '#fde725' :
                     d > 250 ? '#90d743' :
                     d > 200 ? '#35b779' :
                     d > 150 ? '#21918c' :
                     d >  100 ? '#31688e':
                     d > 50 ?   '#443983':
		     d >= 0 ? '#440154':
                                '#666666';
                    }
	          function style1(feature) {
                   return {
                   fillColor: getColor1(feature.properties.Composite_P2P_Ratio),
		    color: 'black',
		    opacity: 0.3,
		    weight: 0.3,
                    fillOpacity: 0.5
                      };
                   }
	         function getColor2(d) {
                    return d > 30 ? '#fde725' :
                     d > 25 ? '#90d743' :
                     d > 20 ? '#35b779' :
                     d > 15 ? '#21918c' :
                     d >  10 ? '#31688e':
                     d > 5 ?   '#443983':
                                '#440154';
                    }
	          function style2(feature) {
                   return {
                   fillColor: getColor2(feature.properties.Composite_P2P_Ratio),
		    color: 'black',
		    opacity: 0.3,
		    weight: 0.3,
                    fillOpacity: 0.5
                      };
                   }
	         //adding map
                 var map = L.map('map',{layers: [cartoMap]}).setView([41.4, -81.7], 8.5);
	    
	         //defining geojson layers
                 var pc16Layer = L.geoJson(null,{style:style1, onEachFeature: function (f, l) {
                 l.bindPopup('<pre>'+JSON.stringify(f.properties,null,' ').replace(/[\{\}"]/g,'')+'</pre>');
                 }});
                 var pc19Layer = L.geoJson(null,{style:style1, onEachFeature: function (f, l) {
                 l.bindPopup('<pre>'+JSON.stringify(f.properties,null,' ').replace(/[\{\}"]/g,'')+'</pre>');
                 }});
                 var sc16Layer = L.geoJson(null,{style:style1, onEachFeature: function (f, l) {
                 l.bindPopup('<pre>'+JSON.stringify(f.properties,null,' ').replace(/[\{\}"]/g,'')+'</pre>');
                 }});
                 var sc19Layer = L.geoJson(null,{style:style1, onEachFeature: function (f, l) {
                 l.bindPopup('<pre>'+JSON.stringify(f.properties,null,' ').replace(/[\{\}"]/g,'')+'</pre>');
                 }});
	    
	 //adding geojsons to map   
         $.getJSON(pc16Url, function(data) {			
		pc16Layer.addData(data);
	 });
         $.getJSON(pc19Url, function(data) {			
		pc19Layer.addData(data);
 	 });
         $.getJSON(sc16Url, function(data) {			
		sc16Layer.addData(data);
	 });
         $.getJSON(sc19Url, function(data) {			
		sc19Layer.addData(data);
	 });

	var groupedOverlays = {
  		"Primary Care": {
   		 "2016": pc16Layer,
    		 "2019": pc19Layer
  		},
		"Specialty Care": {
   		 "2016": sc16Layer,
    		 "2019": sc19Layer
		}
		};
 
	 //defining layers for control
         var baseLayers = {
		"Carto Light": cartoMap,
		"USGS Imagery": USGSMap
		};
	    

        //layer control tool
	var options = {
 	 // Make the "Landmarks" group exclusive (use radio inputs)
  	exclusiveGroups: ["Primary Care", "Specialty Care"],
       // Show a checkbox next to non-exclusive group labels for toggling all
  	groupCheckboxes: true
	};

	var layers = L.control.groupedLayers(baseLayers, groupedOverlays, options);
	layers.addTo(map);
	//var selectedOverlay = null;
         //   function updateSelectedOverlay(layer) {
           //           setTimeout(function() {
             //          if (selectedOverlay) map.removeLayer(selectedOverlay); 
		//       selectedOverlay = layer;
             //                }, 1);
            //               }
		// 	map.on('overlayadd', function(event) {
 	// 		 updateSelectedOverlay(event.layer)
		// 	  });
	// 		map.on('overlayremove', function(event) {
  	// 		selectedOverlay = null;
	// 		  });
        L.control.scale({imperial: true, metric: true}).addTo(map);
        
	//legend options
        var legend = L.control({ position: "bottomright"});
        //adding legend to map
        legend.onAdd = function(map) {
          var div = L.DomUtil.create("div", "legend");
          div.innerHTML += "<h4>Spatial Provider-to-Population Ratio</h4>";
          div.innerHTML += '<i style="background: #440154"><50</i><span></span><br>';
	  div.innerHTML += '<i style="background: #443983">50-99</i><span></span><br>';
	  div.innerHTML += '<i style="background: #31688e">100-149</i><span></span><br>';
	  div.innerHTML += '<i style="background: #21918c">150-199</i><span></span><br>';
	  div.innerHTML += '<i style="background: #35b779">200-249</i><span></span><br>';
	  div.innerHTML += '<i style="background: #90d743">250-299</i><span></span><br>';
	  div.innerHTML += '<i style="background: #fde725">300+</i><span></span><br>';
	  div.innerHTML += '<i style="background: #666666">Missing</i><span></span><br>';


         return div;
         };

         legend.addTo(map);

    </script>
  </body>
</html>
